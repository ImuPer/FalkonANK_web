{% extends 'base.html.twig' %}

{% trans_default_domain 'messages' %}

{% block title %}
  {{ 'profile.title'|trans }}
{% endblock %}

{% block body %}
  <link rel="stylesheet" href="{{ asset('css/profil.css') }}">

  <div class="container-fluid mt-4">
    <div class="row justify-content-center">
      <a href="{{ path('app_home_page') }}">
        <button type="button" class="btn btn-dark">{{ 'profile.back_to_shop'|trans }}</button>
      </a>
      <div class="col-lg-8 col-md-10 col-sm-12">
        <h3 class="mb-4">{{ 'profile.personal_data'|trans }}</h3>

        <div class="table-responsive">
          <table class="table table-light">
            <tbody>
              <tr>
                <th>{{ 'profile.email'|trans }}</th>
                <td>{{ user.email }}</td>
              </tr>
              <tr>
                <th>{{ 'profile.name'|trans }}</th>
                <td>{{ user.firstName }} {{ user.lastName }}</td>
              </tr>
              <tr>
                <th>{{ 'profile.address'|trans }}</th>
                <td>{{ user.adress }}</td>
              </tr>
              <tr>
                <th>
                  <a class="btn btn-secondary" href="{{ path('app_user_edit', {'id': app.user.id}) }}">
                    {{ 'profile.edit'|trans }}
                  </a>
                </th>
                <td class="text-danger">
                  {{ include('user/_delete_form.html.twig') }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        {% if message is defined and message is not empty %}
          <div class="alert alert-success">{{ message|trans }}</div>
        {% endif %}

        {% if is_granted('ROLE_MERCHANT') and (shops is not defined or shops != []) %}
          <a href="{{ path('admin') }}" class="btn btn-primary mb-3">{{ 'profile.merchant'|trans }}</a>
        {% endif %}

        <div class="mt-4">
          {% if merchant is null and not is_granted('ROLE_MERCHANT') %}
            <span class="icon-merchant" title="{{ 'profile.become_merchant'|trans }}">
              <a href="#" data-bs-toggle="modal" data-bs-target="#merchantModal">
                <i class="fas fa-store fa-2x text-primary"></i>
              </a>
            </span>

            <div class="modal fade" id="merchantModal" tabindex="-1" aria-labelledby="merchantModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="merchantModalLabel">{{ 'profile.become_merchant'|trans }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ 'profile.close'|trans }}"></button>
                  </div>
                  <div class="modal-body">
                    <form method="post" action="{{ path('merchant_register') }}" enctype="multipart/form-data">
                      <div class="mb-3">
                        <label for="city" class="form-label">{{ 'profile.city'|trans }}</label>
                        <select class="form-select border" id="city" name="city_id" required>
                          <option value="">{{ 'profile.select_city'|trans }}</option>
                          {% for city in cities %}
                            <option value="{{ city.id }}">{{ city.name }}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="shopName" class="form-label">{{ 'profile.shop_name'|trans }}</label>
                        <input type="text" class="form-control border" id="shopName" name="shop_name" placeholder="{{ 'profile.shop_name_placeholder'|trans }}" required>
                      </div>
                      <div class="mb-3">
                        <label for="shopAddress" class="form-label">{{ 'profile.shop_address'|trans }}</label>
                        <input type="text" class="form-control border" id="shopAddress" name="shop_address" placeholder="{{ 'profile.shop_address_placeholder'|trans }}" required>
                      </div>
                      <div class="mb-3">
                        <label for="merchantNif" class="form-label">{{ 'profile.nif'|trans }}</label>
                        <input type="text" class="form-control border" id="merchantNif" name="merchant_nif" placeholder="{{ 'profile.nif_placeholder'|trans }}" required pattern="^[1235]\d{8}$" maxlength="9" title="{{ 'profile.nif_title'|trans }}">
                        <div class="form-text text-muted small" style="font-size: 0.75em;">
                          {{ 'profile.nif_help'|trans }}
                        </div>
                      </div>
                      <!-- Ajoute ici les autres champs de formulaire, tous traduits de faÃ§on similaire -->

                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ 'profile.cancel'|trans }}</button>
                        <button type="submit" class="btn btn-primary">{{ 'profile.submit'|trans }}</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>

          {% elseif merchant is not null and not merchant.isApproved and merchant.reponse is null %}
            <div class="alert alert-info">
              <strong>{{ 'profile.merchant_pending'|trans }}</strong>
              <hr>
              <p><strong>{{ 'profile.shop_name'|trans }}:</strong> {{ merchant.name }}</p>
              <p><strong>{{ 'profile.city'|trans }}:</strong> {{ merchant.city.name }}</p>
              <p><strong>{{ 'profile.shop_address'|trans }}:</strong> {{ merchant.address }}</p>
              <p><strong>{{ 'profile.description'|trans }}:</strong> {{ merchant.description }}</p>
              <p><strong>{{ 'profile.submitted_at'|trans }}:</strong> {{ merchant.createdAt|date('d/m/Y H:i') }}</p>
              <hr>
              <!-- Ajoute les infos bancaires traduites -->
              <p><a class="btn btn-warning mt-2" href="{{ path('merchant_edit', {'id': merchant.id}) }}">{{ 'profile.edit_store_data'|trans }}</a></p>
            </div>

          {% elseif merchant is not null and not merchant.isApproved and merchant.reponse is not null %}
            <div class="alert alert-danger">
              <strong>{{ 'profile.merchant_rejected'|trans }}</strong>
              <p><strong>{{ 'profile.reason'|trans }}:</strong> {{ merchant.reponse }}</p>
              <hr>
              <p>{{ 'profile.more_info'|trans }}</p>
              <a href="{{ path('contact_nous') }}">
                <button class="btn btn-primary">{{ 'profile.contact_us'|trans }}</button>
              </a>
            </div>

          {% elseif merchant is not null and merchant.isApproved %}
            <div class="alert alert-success">
              <strong>{{ 'profile.merchant_approved'|trans }}</strong>
              {% if merchant.reponse is not null %}
                <p><strong>{{ 'profile.admin_message'|trans }}:</strong> {{ merchant.reponse }}</p>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
